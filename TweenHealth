-- =====HEALTH TWEEN=====
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

local Fill
local currentTween
local humanoid

-- หา Fill Bar
local function getFill()
    local topBarApp = game:GetService("CoreGui"):FindFirstChild("TopBarApp")
    local unibar = topBarApp and topBarApp:FindFirstChild("TopBarApp"):FindFirstChild("UnibarLeftFrame")
    local healthBar = unibar and unibar:FindFirstChild("HealthBar")
    return healthBar and healthBar:FindFirstChild("HealthBar") and healthBar.HealthBar:FindFirstChild("Fill")
end

-- Tween ขนาด Fill
local function tweenFill(percent)
    if not Fill then return end
    if currentTween then currentTween:Cancel() end
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    currentTween = TweenService:Create(Fill, tweenInfo, {Size = UDim2.new(percent,0,1,0)})
    currentTween:Play()
end

-- ตั้งค่า Humanoid
local function setupHumanoid(h)
    humanoid = h
    humanoid:GetPropertyChangedSignal("Health"):Connect(function()
        if not Fill then Fill = getFill() end
        if Fill then
            local percent = humanoid.Health / humanoid.MaxHealth
            tweenFill(percent)
        end
    end)
end

-- ตรวจสอบ Character Spawn
player.CharacterAdded:Connect(function(char)
    local h = char:WaitForChild("Humanoid")
    setupHumanoid(h)
    Fill = getFill()
end)

-- ถ้ามี Character อยู่แล้ว
if player.Character then
    local h = player.Character:FindFirstChild("Humanoid")
    if h then
        setupHumanoid(h)
        Fill = getFill()
    end
end
